import streamlit as st

def render_chat_history(history):
    for turn in history:
        st.chat_message("user").write(turn["user"])

        with st.chat_message("assistant"):
            show_result_block(turn["assistant"], turn["uncertainty"], turn["docs"])


def show_result_block(answer, uncertainty, docs):
    st.markdown(f"**Answer:** {answer}")
    
    if uncertainty is not None:
        st.caption(f" **Uncertainty Score:** {uncertainty:.3f}")

    with st.expander("ðŸ“„ Retrieved Context"):
        for i, doc in enumerate(docs):
            meta = doc.get("metadata", {})
            snippet = doc.get("text", "")[:400]
            st.markdown(f"**Snippet {i+1}**")
            st.markdown(f"> {snippet}")
            if meta:
                st.markdown(f"<sub>{meta}</sub>", unsafe_allow_html=True)
